<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Playlist</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for a clean look */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style for the responsive video container */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
        }
        .video-container iframe,
        .video-container div {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        /* Custom scrollbar for the playlist */
        .playlist-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .playlist-scroll::-webkit-scrollbar-track {
            background-color: #f1f1f1;
            border-radius: 10px;
        }
        .playlist-scroll::-webkit-scrollbar-thumb {
            background-color: #888;
            border-radius: 10px;
        }
        .playlist-scroll::-webkit-scrollbar-thumb:hover {
            background-color: #555;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Custom Notification Box -->
    <div id="notification" class="fixed top-5 right-5 bg-red-500 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-50">
        This is a notification.
    </div>

    <div class="container mx-auto p-4 md:p-8">
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">My Video Library</h1>
            <p class="text-gray-600 mt-2">Select a video from the playlist to watch it.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Video Player Section -->
            <div class="lg:col-span-2 bg-white p-4 rounded-lg shadow-lg">
                <div id="video-player-container" class="video-container rounded-lg">
                    <!-- The YouTube API will replace this div with an iframe -->
                    <div id="video-player"></div>
                </div>
                 <h2 id="video-title" class="text-2xl font-semibold mt-4 text-gray-800"></h2>
            </div>

            <!-- Playlist Section -->
            <div class="lg:col-span-1 bg-white p-4 rounded-lg shadow-lg flex flex-col">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-xl font-bold">Playlist</h3>
                    <button id="clear-playlist-btn" class="text-sm bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600 transition-colors duration-200 font-semibold">Clear All</button>
                </div>
                
                <!-- Add Video Form -->
                <div class="mb-4 border-b pb-4">
                    <h4 class="font-semibold text-gray-700 mb-2">Add New Video</h4>
                    <div class="space-y-2">
                        <input type="text" id="video-url-input" placeholder="YouTube URL or Video ID" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
                        <input type="text" id="video-title-input" placeholder="Video Title" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
                        <button id="add-video-btn" class="w-full bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 transition-colors duration-200 font-semibold">Add to Playlist</button>
                    </div>
                </div>

                <div id="playlist" class="space-y-2 overflow-y-auto playlist-scroll flex-grow" style="max-height: 60vh;">
                    <!-- Playlist items will be generated here by JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <!-- YouTube IFrame Player API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Configuration ---
            const STORAGE_KEY = 'youtube_playlist_app_videos';

            // Default videos to show if localStorage is empty
            const defaultVideos = [
                { id: 'p3-c0DF_2-I', title: 'WebGL Beginner\'s Guide - Get Started in 15 Minutes' },
                { id: '3JZ_D3ELwOQ', title: 'Three.js Tutorial for Absolute Beginners' },
                { id: 'Jc-iYMr_uHw', title: 'Introduction to Generative AI' },
                { id: 'f01_2-x0A2Y', title: 'Advanced Three.js - Physics and Animation' },
                { id: 'sO5APf69o_A', title: 'The Future of AI - Full Documentary' },
                { id: 'YzP1642g__M', title: 'Shader Programming in Three.js' },
                { id: 'Q31-g4-I7f4', title: 'Neural Networks from Scratch' },
                { id: 'xK7sEV2y4sQ', title: 'Learn WebGL from the Ground Up' },
                { id: 'I22f3sJ-2i0', title: 'Create a 3D Website with Three.js' }
            ].map(v => ({ ...v, currentTime: 0 }));
            
            // --- State Variables ---
            let videos;
            let player;
            let timeUpdateInterval;
            let currentVideoId = null;

            // --- Element References ---
            const videoTitleElement = document.getElementById('video-title');
            const playlistElement = document.getElementById('playlist');
            const videoUrlInput = document.getElementById('video-url-input');
            const videoTitleInput = document.getElementById('video-title-input');
            const addVideoButton = document.getElementById('add-video-btn');
            const clearPlaylistButton = document.getElementById('clear-playlist-btn');
            const notificationElement = document.getElementById('notification');
            let notificationTimeout;


            // --- YouTube IFrame API Setup ---
            
            // This global function is called by the YouTube API script when it's ready.
            window.onYouTubeIframeAPIReady = function() {
                const firstVideo = videos.length > 0 ? videos[0] : null;
                currentVideoId = firstVideo ? firstVideo.id : null;

                player = new YT.Player('video-player', {
                    height: '100%',
                    width: '100%',
                    videoId: currentVideoId,
                    playerVars: {
                        'playsinline': 1,
                        'rel': 0,
                        'start': firstVideo ? Math.floor(firstVideo.currentTime) : 0
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            };

            function onPlayerReady(event) {
                // Update UI for the initially loaded video.
                if (videos.length > 0) {
                    const firstVideo = videos[0];
                    videoTitleElement.textContent = firstVideo.title;
                    updateActivePlaylistItem(firstVideo.id);
                }
            }

            function onPlayerStateChange(event) {
                clearInterval(timeUpdateInterval); // Clear any existing interval
                if (event.data === YT.PlayerState.PLAYING) {
                    // When video is playing, update time every 2 seconds
                    timeUpdateInterval = setInterval(saveCurrentTime, 2000);
                } else {
                    // Save one last time when paused or ended
                    saveCurrentTime();
                }
            }


            // --- Core Functions ---

            function loadAndPrepareVideos() {
                const storedVideos = JSON.parse(localStorage.getItem(STORAGE_KEY));
                // Ensure every video object has a currentTime property, defaulting to 0
                videos = (storedVideos || defaultVideos).map(v => ({
                    id: v.id,
                    title: v.title,
                    currentTime: v.currentTime || 0
                }));
            }

            function saveVideos() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(videos));
            }

            function saveCurrentTime() {
                if (!player || typeof player.getCurrentTime !== 'function' || !currentVideoId) {
                    return; // Player not ready or no video loaded
                }
                const currentTime = player.getCurrentTime();
                const videoIndex = videos.findIndex(v => v.id === currentVideoId);

                if (videoIndex > -1) {
                    videos[videoIndex].currentTime = currentTime;
                    saveVideos();
                    // Also update the time display in the playlist in real-time
                    const timeDisplay = playlistElement.querySelector(`div[data-video-id="${currentVideoId}"] .time-display`);
                    if (timeDisplay) {
                        const minutes = Math.floor(currentTime / 60).toString().padStart(2, '0');
                        const seconds = Math.floor(currentTime % 60).toString().padStart(2, '0');
                        timeDisplay.textContent = `${minutes}:${seconds}`;
                    }
                }
            }
            
            function showNotification(message) {
                if (notificationTimeout) clearTimeout(notificationTimeout);
                notificationElement.textContent = message;
                notificationElement.classList.remove('opacity-0');
                notificationTimeout = setTimeout(() => {
                    notificationElement.classList.add('opacity-0');
                }, 3000);
            }

            function extractVideoId(url) {
                if (!url) return null;
                if (url.length === 11 && !url.includes('.')) return url;
                const regex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?|shorts)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                const match = url.match(regex);
                return match ? match[1] : null;
            }

            function handleAddVideo() {
                const url = videoUrlInput.value.trim();
                const title = videoTitleInput.value.trim();

                if (!url || !title) {
                    showNotification('Please provide both a video URL/ID and a title.');
                    return;
                }
                const videoId = extractVideoId(url);
                if (!videoId) {
                    showNotification('Could not find a valid YouTube video ID in the URL.');
                    return;
                }
                if (videos.some(video => video.id === videoId)) {
                    showNotification('This video is already in the playlist.');
                    return;
                }

                videos.push({ id: videoId, title: title, currentTime: 0 });
                saveVideos();
                generatePlaylist();
                videoUrlInput.value = '';
                videoTitleInput.value = '';
            }
            
            function handleClearPlaylist() {
                if (player && typeof player.stopVideo === 'function') {
                    player.stopVideo();
                    player.clearVideo();
                }
                currentVideoId = null;
                videos = [];
                saveVideos();
                generatePlaylist();
                videoTitleElement.textContent = 'Playlist Cleared';
            }

            function loadVideo(videoId, videoTitle) {
                if (!player) return;

                const videoData = videos.find(v => v.id === videoId);
                const startTime = videoData ? Math.floor(videoData.currentTime) : 0;
                
                player.loadVideoById({
                    videoId: videoId,
                    startSeconds: startTime
                });

                currentVideoId = videoId;
                videoTitleElement.textContent = videoTitle;
                updateActivePlaylistItem(videoId);
            }

            function generatePlaylist() {
                playlistElement.innerHTML = '';
                videos.forEach(video => {
                    const item = document.createElement('div');
                    item.className = 'p-3 rounded-lg cursor-pointer transition-colors duration-200 hover:bg-blue-100 flex items-center space-x-3';
                    item.dataset.videoId = video.id;
                    
                    const timeInSeconds = video.currentTime || 0;
                    const minutes = Math.floor(timeInSeconds / 60).toString().padStart(2, '0');
                    const seconds = Math.floor(timeInSeconds % 60).toString().padStart(2, '0');
                    const timeString = `${minutes}:${seconds}`;

                    const playIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
                    const titleSpan = `<span class="flex-1 truncate">${video.title}</span>`;
                    const timeSpan = `<span class="text-xs text-gray-500 font-mono time-display">${timeString}</span>`;
                    item.innerHTML = playIcon + titleSpan + timeSpan;

                    item.addEventListener('click', () => {
                        loadVideo(video.id, video.title);
                    });
                    playlistElement.appendChild(item);
                });
            }

            function updateActivePlaylistItem(videoId) {
                const items = playlistElement.querySelectorAll('div[data-video-id]');
                items.forEach(item => {
                    if (item.dataset.videoId === videoId) {
                        item.classList.add('bg-blue-200', 'font-semibold');
                        item.classList.remove('hover:bg-blue-100');
                    } else {
                        item.classList.remove('bg-blue-200', 'font-semibold');
                        item.classList.add('hover:bg-blue-100');
                    }
                });
            }

            function initializeApp() {
                loadAndPrepareVideos();
                generatePlaylist();
                // Player initialization is handled by onYouTubeIframeAPIReady
            }
            
            // --- Event Listeners ---
            addVideoButton.addEventListener('click', handleAddVideo);
            clearPlaylistButton.addEventListener('click', handleClearPlaylist);

            // --- Initial Setup ---
            initializeApp();
        });
    </script>
</body>
</html>

